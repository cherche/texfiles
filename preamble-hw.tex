
\usepackage{hyperref}

% equation numbers should be pretty transient
\usepackage{chngcntr}
\counterwithin*{equation}{section}

\declaretheoremstyle[
    headfont=\bfseries\sffamily\color{Magenta!70!black}, bodyfont=\normalfont,
    mdframed={
        linewidth=2pt,
        rightline=false, topline=false, bottomline=false,
        linecolor=Magenta, backgroundcolor=Magenta!5,
    }
]{thmpinkbox}
% TODO: Fix question numbers. Want them to exactly match section numbers
\declaretheorem[style=thmpinkbox, name=Question, numbered=no]{q}

% homework styles for section headings
\renewcommand{\thesubsection}{\arabic{section}(\alph{subsection})}
\renewcommand{\thesection}{\arabic{section}}
\usepackage{titlesec}
% Don't need this. We never print \section
%\titleformat{\section}
%  {\normalfont\Large\bfseries}{Q\thesection}{1em}{}
% subquestions get placed in left margin
\titleformat{\subsection}[leftmargin]
%  {\normalfont\bfseries\filleft}{\thesubsection}{0.5em}{}
  % remove spacing after number because we never name subsections
  {\normalfont\bfseries\filleft}{\thesubsection}{0em}{}
\titlespacing*{\subsection}{8pc}{1.5pc}{1.2pc}

% fakesection to add question to TOC and bookmarks
% while still not printing it to the actual document
\newcommand{\fakesection}[1]{%
  \par\refstepcounter{section}% Increase section counter
  \sectionmark{#1}% Add section mark (header)
  \addcontentsline{toc}{section}{Question \protect\numberline{\thesection}#1}% Add section to ToC
}

\newcommand{\question}[1]{%
  \setcounter{section}{#1-1}
  \fakesection{}%
}

% solution command to prettify source
\newcommand{\solution}[1]{%
  \ifthenelse{\isempty{#1}}{%
    \subsection*{}%
  }{%
    % https://tex.stackexchange.com/questions/595582/converting-letters-to-numbers-e-g-a-0-b-1-et-cetera
    \setcounter{subsection}{\number\numexpr`#1-`a\relax}%
    \subsection{}%
  }%
  % We maintain a subsection counter so that labels work correctly
  % the only issue is that now we can't get custom subsection headings,
  % such as 1(cd) for when multiple questions are answered at once
}

% need this to properly print the section numbers
% especially since \section and \subsection have no marks (just the numbering)
\usepackage[open, openlevel=2, atend, numbered]{bookmark}
% without the above line, structure still correct but all the entries are blank
% open and openlevel=2 are just nice to have since sections are so short

\makeatletter
% fancy header
\usepackage{fancyhdr}
\pagestyle{fancy}
\setlength{\headheight}{14.5pt}
\addtolength{\topmargin}{-2.5pt}
\fancyhead[L]{\@title}
\fancyhead[C]{\@author}
\fancyhead[R]{\@date}
\fancyfoot[L]{}
\fancyfoot[C]{}
\fancyfoot[R]{\thepage}

% include question and ensure every question gets new page
% this separates the \clearpage functionality from the \section
\newcommand\inputq[1]{%
  \input{./#1.tex}%
  \clearpage%
}
